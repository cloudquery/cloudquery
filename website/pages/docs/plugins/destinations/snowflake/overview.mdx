---
name: Snowflake
title: Snowflake Destination Plugin
description: CloudQuery Snowflake destination plugin documentation
---
# Snowflake Destination Plugin

import { getLatestVersion } from "../../../../../utils/versions";
import { Badge } from "../../../../../components/Badge";
import Configuration from "./_configuration.mdx";

<Badge text={"Latest: " + getLatestVersion("destination", "snowflake")}/>

The snowflake plugin helps you sync data to your Snowflake data warehouse.

There are two ways to sync data to Snowflake:

1. Direct (easy but not recommended for production or large data sets): This is the default mode of operation where CQ plugin will stream the results directly to the Snowflake database. There is no additional setup needed apart from authentication to Snowflake.

2. Loading via CSV/JSON from a remote storage: This is the standard way of loading data into Snowflake, it is recommended for production and large data sets. This mode requires a remote storage (e.g. S3, GCS, Azure Blob Storage) and a Snowflake stage to be created. The CQ plugin will stream the results to the remote storage. You can then load those files via a cronjob or via SnowPipe. This method is still in the works and will be updated soon with a guide.

## Example Config

<Configuration />

The Snowflake destination utilizes batching, and supports [`batch_size`](/docs/reference/destination-spec#batch_size) and [`batch_size_bytes`](/docs/reference/destination-spec#batch_size_bytes).

## Authentication

Authentication of the connection to Snowflake can be specified using:

* A username and password in the DSN:

  ```yaml
  kind: destination
  spec:
    name: snowflake
    ...
    spec:
      connection_string: "user:pass@account/db/schema?warehouse=wh"
  ```

* A username and password in separate fields:

  ```yaml
  kind: destination
  spec:
    name: snowflake
    ...
    spec:
      user: user
      password: pass
      account: account
      warehouse: wh
      database: db
      schema: schema
  ```

* A private key inline:

  ```yaml
  kind: destination
  spec:
    name: snowflake
    ...
    spec:
      user: user
      account: acc
      private_key: |
        -----BEGIN PRIVATE KEY-----
        MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC2ajPRIbPtbxZ1
        3DONLA02eZJuCzsgIkBWov/Me5TL6cKN0gnY+mbA8OnNCH+9HSzgiU9P8XhTUrIN
        85diD+rj6uK+E0sSyxGk6HG17TyR5oBq8nz2hbZlbaNi/HO9qYoHQgAgMq908YBz
        ...
        DUmOIrBYEMf2nDTlTu/QVcKb
        -----END PRIVATE KEY-----
      warehouse: wh
      database: db
      schema: schema
  ```

* A private key included from a file:

  ```yaml
  kind: destination
  spec:
    name: snowflake
    ...
    spec:
      user: user
      account: acc
      private_key: "${file:./private.key}"
      warehouse: wh
      database: db
      schema: schema
  ```

  where ./private.key is PEM-encoded private key file with contents of the form:

  ```txt
  -----BEGIN PRIVATE KEY-----
  MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC2ajPRIbPtbxZ1
  3DONLA02eZJuCzsgIkBWov/Me5TL6cKN0gnY+mbA8OnNCH+9HSzgiU9P8XhTUrIN
  85diD+rj6uK+E0sSyxGk6HG17TyR5oBq8nz2hbZlbaNi/HO9qYoHQgAgMq908YBz
  ...
  DUmOIrBYEMf2nDTlTu/QVcKb
  -----END PRIVATE KEY-----
  ```

### Private Key Authentication Setup

The Snowflake guide for [Key Pair
Authentication](https://docs.snowflake.com/en/user-guide/key-pair-auth)
demonstrates how to create an RSA private key with the ability to authenticate
as a Snowflake user.

Note that encrypted private keys are not supported by the Snowflake Go SQL
driver, and hence not supported by the CloudQuery Snowflake plugin. You can
decrypt a private key in file enc.key and store it in a file dec.key using the
following command:

```bash
openssl pkcs8 -topk8 -nocrypt -in enc.key -out dec.key
```

## Snowflake Spec

This is the top level spec used by the Snowflake destination plugin.

Note that either `connection_string`, or `account`, `user`, etc. must be
configured to connect to Snowflake.


### Authentication parameters

- `connection_string` (`string`) (optional)

  Snowflake `connection_string`.

  Example:

  ```yaml copy
  # user[:password]@account/database/schema?warehouse=user_warehouse[&param1=value1&paramN=valueN]
  # or
  # user[:password]@account/database?warehouse=user_warehouse[&param1=value1&paramN=valueN]
  # or
  # user[:password]@host:port/database/schema?account=user_account&warehouse=user_warehouse[&param1=value1&paramN=valueN]
  # or
  # host:port/database/schema?account=user_account&warehouse=user_warehouse[&param1=value1&paramN=valueN]
  ```

  From Snowflake documentation:

  `account` - Name assigned to your Snowflake account. If you are not on us-west-2 or AWS deployment, append the region and platform to the end, e.g., `<account>.<region>` or `<account>.<region>.<platform>`.

- `account` (`string`) (required if not in `connection_string`)

  The name of the account. May include the region as "acc.europe-west4.gcp", for example.

- `region` (`string`) (optional) (default: `us-west-2`)

  The region in which the account is defined.

- `user` (`string`) (required if not in `connection_string`)

  The name of the user to authenticate and write as.

- `role` (`string`) (optional)

  Specifies the default access control role to use in the Snowflake session
  initiated. The specified role should be an existing role that has already been
  assigned to the specified user, otherwise the role is not used.

- `password` (`string`) (optional)

  A password to authenticate as the named user.

- `private_key` (`string`) (optional)

  The PEM-encoded private key. See [authentication examples](#authentication).

- `jwt_expire_timeout_ms` (`int`) (optional)

  JWT expiry timeout in milliseconds.

- `login_timeout_ms` (`int`) (optional)

  Login retry timeout in milliseconds excluding network roundtrip and HTTP response reading.

- `client_store_temporary_credential` (`*bool`) (optional)

  Cache the ID token in the credential manager. Defaults to true on Windows and OS X and false on Linux.


### Database parameters

- `warehouse` (`string`) (required if not in `connection_string`)

  Specifies the virtual warehouse to use once connected.

- `database` (`string`) (required if not in `connection_string`)

  Specifies the database in which to look for the schema and create file formats.

- `schema` (`string`) (required if not in `connection_string`)

  Specifies the schema in which to create and populate tables.

- `application` (`string`) (optional)

  (Snowflake partner use only.) Specifies the name of the partner application to connect through.


### Connection parameters

- `params` (`map[string]string`) (optional)

  Extra connection parameters to include in the Snowflake DSN.

- `client_ip` (`string`) (optional)

- `protocol` (`string`) (optional)

  "HTTP" or "HTTPS".

- `host` (`string`) (optional) (default: `${account}.${region}.snowflakecomputing.com`)

  The Snowflake service to connect to.

- `port` (`int`) (optional) (default: `443`)

  The port of the Snowflake service to connect to.

- `insecure_mode` (`*bool`) (optional)

  Don't validate Snowflake certificates.

- `ocsp_fail_open` (`string`) (optional)

  Specifies that the driver should “fail open” if unable reach the OCSP server
  to verify the certificate.

  When the driver connects, Snowflake sends a certificate to confirm that the
  connection is to Snowflake rather than to a host that is impersonating
  Snowflake. The driver sends that certificate to an OCSP (Online Certificate
  Status Protocol) server to verify that the certificate has not been revoked.

  If the driver cannot reach the OCSP server to verify the certificate, the
  driver can [“fail open” or “fail closed”](https://docs.snowflake.com/en/user-guide/ocsp#label-ocsp-fail-open-or-fail-close).

- `keep_session_alive` (`*bool`) (optional)

- `disable_telemetry` (`*bool`) (optional)

- `tracing` (`string`) (optional)

- `request_timeout_ms` (`int`) (optional)

  Request retry timeout in milliseconds excluding network roundtrip and HTTP response reading.

- `client_timeout_ms` (`int`) (optional)

  Timeout in milliseconds for network roundtrip and reading HTTP responses.


### Table migration parameters

- `migrate_concurrency` (`integer`) (optional) (default: `1`)

  By default, tables are migrated one at a time.
  This option allows you to migrate multiple tables concurrently.
  This can be useful if you have a lot of tables to migrate and want to speed up the process.

  Setting this to a negative number means no limit.


### Batch-writing parameters

- `batch_size` (`integer`) (optional) (default: `1000`)

  Number of records to batch together before sending to the database.

- `batch_size_bytes` (`integer`) (optional) (default: `4194304` (= 4 MiB))

  Number of bytes (as Arrow buffer size) to batch together before sending to the database.

## Underlying library

We use the official [github.com/snowflakedb/gosnowflake](https://github.com/snowflakedb/gosnowflake) package for database connection.
