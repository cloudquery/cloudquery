---
title: How to Manage AWS Resource and Usage Limits with CloudQuery and Service Quotas
tag: tutorial
description: >-
  Cloud Usage
author: jsonkao
---

import { HowToGuideHeader } from "../../components/HowToGuideHeader"

<HowToGuideHeader/>

## Introduction

AWS Accounts come with over 200 services and each service has different types of resources.  Benefits of cloud computing include the ease of use, elasticity, and advantages of using these cloud services.  However, cloud services come with usage and resource limits.  Proper management of these usage and resource limits can prevent against availability issues when a resource cannot be created, a service is throttled, and helps with proactive management and troubleshooting of limit constraints that may impact active production applications and development environments. 

In 2019, [AWS introduced Service Quotas](https://aws.amazon.com/blogs/mt/introducing-service-quotas-view-and-manage-your-quotas-for-aws-services-from-one-central-location/), a new service to help with managing these limits (now called quotas) from a central location.

### Example Limit Scenarios

Example scenarios we've seen where resource management (as of June 2023):

* Reaching the maximum number of S3 buckets in an account.  The default limit of S3 buckets in an account is 100.

* Reaching the maximum number of Lambda network interfaces.  The default limit of network interfaces that Lambda creates for a VPC with functions attached is 250.  Lambda creates a network interface for each combination of function subnets and seurity groups.

* Reaching KMS Key API Limits.  KMS has API Limits that are adjustable such as CreateAlias and CreateKey request rates which by default are set to 5 per second.  Some applications and enterprise architectures may require higher request rates.

* Reaching CloudFormation Stack Limits.  Accounts by default have a default limit of 2000 Stacks.  For teams with heavy infrastructure as code practices and in accounts with heavy infrastructure, teams could reach the maximum number of stacks. 

* Reaching Identity and Access limits including managed policies per role.  By default, roles can have a maximum number of 10 attached managed policies.  For teams that use many managed policies to attach custom permissions to IAM principals, they may reach the limit of 10 managed policies and be unable to attach more policies or have failed attachments.

Other limits include EC2 with spot instances, networking, number of running dedicated hosts.


## Managing Service Quotas

https://www.cloudquery.io/docs/plugins/sources/aws/tables/aws_servicequotas_quotas

One option provided by AWS is to utilize AWS Trusted Advisor (and AWS Support).  [AWS Trusted Advisor](https://aws.amazon.com/premiumsupport/technology/trusted-advisor/) offers checks for service quotas with AWS Basic Support and AWS Developer Support Plans.  AWS Business and Enterprise Support customers get all checks which include service quota checks.  However, Trusted Advisor currently (as of June 2023) only supports 51 checks.  Additionally, programmatic access to Trusted Advisor APIs (and Support) requires either a Business, Enterprise On-Ramp, or Enterprise Support Plan with AWS.

![Trusted Advisor Console](/images/how-to-guides/aws-resource-limits-and-service-quotas/trusted-advisor.png)

Another option is to integrate AWS Service Quotas with CloudWatch for alerting.  However, these integrations only [work with Service Quotas that support CloudWatch Alarms](https://docs.aws.amazon.com/servicequotas/latest/userguide/configure-cloudwatch.html).

With CloudQuery, we'll demonstrate another option: how to use CloudQuery to manage and monitor resource utilization and service quota usage.  We'll also use CloudQuery to sync information from Trusted Advisor and Support

## Walkthrough

We'll focus on the following tables and services:
* AWS Service Quotas
* AWS Trusted Advisor


### Queries

```
SELECT * FROM AWS_support_trusted_advisor_checks
WHERE category='service_limits' and language_code='en';
```



## Summary


## References

[CloudQuery: AWS Source Plugin](/docs/plugins/sources/aws/overview)

