name: release-please-monorepo
on:
  push:
    branches:
      - monorepo

jobs:
  release-pr-monorepo:
    runs-on: ubuntu-latest
    steps:
      - uses: google-github-actions/release-please-action@v3
        id: release
        with:
          command: manifest
          token: ${{ secrets.GH_CQ_BOT }}
          default-branch: monorepo
      # We mark all releases as pre-release until we finish building & uploading the binaries
      # GoReleaser will upload the binaries to GitHub and mark the release as ready
      # TODO: Find a way to generalize this part
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['cli--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['cli--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/aws--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/aws--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/azure--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/azure--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/cloudflare--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/cloudflare--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/digitalocean--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/digitalocean--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/fuzz--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/fuzz--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/gcp--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/gcp--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/github--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/github--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/k8s--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/k8s--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/okta--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/okta--tag_name'] }}
        with:
          prerelease: true
      - name: Mark as pre-release
        if: ${{ steps.release.outputs['plugins/terraform--release_created'] }}
        uses: tubone24/update_release@2146f1550a23d883b8ea0c036298ed74cd65eac6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG_NAME: ${{ steps.release.outputs['plugins/terraform--tag_name'] }}
        with:
          prerelease: true